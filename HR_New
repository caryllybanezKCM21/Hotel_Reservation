<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NORACAFRA HOTEL — Reservation System (Frontend Demo)</title>
  <meta name="description" content="NORACAFRA HOTEL Reservation System (frontend demo)." />
  <style>
    :root{
      --accent:#0190d3;
      --accent-dark:#0b84c9;
      --muted:#6b7280;
      --card:#ffffff;
      --bg:#f3f6fb;
      --success:#10b981;
      --danger:#ef4444;
      --max-w:1100px;
      --radius:12px;
      --shadow: 0 8px 30px rgba(2,6,23,0.08);
      --glass: rgba(255,255,255,0.6);
      --font-sans: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:var(--font-sans);background:var(--bg);color:#0f172a;-webkit-font-smoothing:antialiased}
    header{background:linear-gradient(90deg,var(--accent-dark),var(--accent));color:white;padding:14px 20px;display:flex;align-items:center;justify-content:space-between}
    header h1{margin:0;font-size:18px;letter-spacing:1px}
    nav.app-nav{display:flex;gap:8px;align-items:center}
    nav.app-nav button{background:transparent;color:white;border:1px solid rgba(255,255,255,0.15);padding:8px 10px;border-radius:8px;cursor:pointer}

    .container{max-width:var(--max-w);margin:22px auto;padding:0 16px}
    #appContainer{width:100%;margin:0;padding:0}

    /* layout */
    .app{display:grid;grid-template-columns:240px 1fr;gap:18px;margin-top:18px}
    .sidebar{background:var(--card);padding:14px;border-radius:12px;min-height:70vh;box-shadow:var(--shadow)}
    .sidebar h4{margin:0 0 8px}
    .menu{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
    .menu button{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;border:1px solid transparent;background:transparent;cursor:pointer}
    .menu button.active{background:#eef9ff;border-color:#dff6ff}
    .content{min-height:70vh}
    .section{display:none;background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.04)}
    .section.active{display:block}

    /* cards & controls */
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.03)}
    .muted{color:var(--muted)}
    .small{font-size:13px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="text"],input[type="password"],select,input[type="date"],input[type="time"],input[type="number"],textarea{
      width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px;margin-bottom:8px;
    }
    button.btn{cursor:pointer;border:0;padding:8px 12px;border-radius:8px;font-weight:600}
    .btn-primary{background:var(--accent-dark);color:white}
    .btn-ghost{background:white;border:1px solid #e6e9ef}

    .centered-notif{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center}

    .grid-3{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .room-card{border-radius:10px;overflow:hidden;background:#fff;border:1px solid #eef2f7}
    .room-card img{width:100%;height:140px;object-fit:cover;display:block}
    .room-card .body{padding:10px}

    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.45);z-index:50}
    .modal .modal-card{width:100%;max-width:720px;background:white;padding:18px;border-radius:12px}

    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #f1f5f9;text-align:left}
    .text-right{text-align:right}

    footer{margin:28px 0;text-align:center;color:var(--muted)}

    @media (max-width:980px){ .app{grid-template-columns:1fr} .sidebar{order:2} }
    /* small helpers */
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px}
    .badge-pending{background:#fff4e6;color:#92400e;border:1px solid #fcd34d}
    .badge-paid{background:#ecfdf5;color:#065f46;border:1px solid #bbf7d0}
    .admin-controls button{margin-right:6px}
    .blue-box{background:linear-gradient(180deg,#e8f7ff,#f3fbff);border:1px solid #dff2ff;padding:12px;border-radius:10px}
  </style>
</head>
<body>

<header>
  <h1>NORACAFRA HOTEL</h1>
  <nav class="app-nav">
    <button id="homeBtn">Home</button>
    <button id="signInBtn">Sign In</button>
  </nav>
</header>

<!-- front / sign-in -->
<div class="container" id="frontPage">
  <div style="max-width:920px;margin:0 auto;display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:center">
    <div>
      

      </div>
    </div>

    <div class="card">
      <h3>Sign In</h3>
      <label>Role</label>
      <select id="roleSelect">
        <option value="guest">Guest</option>
        <option value="staff">Staff</option>
        <option value="admin">Admin</option>
      </select>
      <label>Username</label>
      <input id="username" type="text" placeholder="e.g. guest1 or admin1">
      <label>Password (not required)</label>
      <input id="password" type="password" placeholder="(any)">
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
        <button class="btn btn-ghost" id="openRegisterBtn">Register</button>
        <button class="btn btn-primary" id="signInPrimary">Sign In</button>
      </div>
      <small class="muted">Use <strong>admin1</strong> to view admin panel (demo)</small>
    </div>
  </div>
</div>

<!-- app -->
<div id="appContainer" class="container" style="display:none">
  <div class="app">
    <aside class="sidebar">
      <h4 id="welcomeUser">Welcome</h4>
      <div class="small muted" id="userRole">Role: -</div>
      <hr style="margin:10px 0">
      <ul class="menu" id="menuList">
        <li><button data-show="dashboard" class="active">Dashboard</button></li>
        <li><button data-show="rooms">Room Types</button></li>
        <li><button data-show="dining">Dining & Restaurant</button></li>
        <li><button data-show="makeReservation">Make a Reservation</button></li>
        <li><button data-show="mybookings">My Bookings</button></li>
        <li><button data-show="other">Other Amenities</button></li>
        <li><button data-show="reports">Reports</button></li>
        <li id="adminMenuItem" style="display:none"><button data-show="adminPanel">Admin Panel</button></li>
        <li><button id="logoutBtn" style="color:var(--danger)">Log Out</button></li>
      </ul>
    </aside>

    <main class="content">
      <!-- Dashboard -->
      <section id="dashboard" class="section active">
        <h3>Dashboard</h3>
        <p class="small muted">Quick overview and notifications</p>

        <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px;align-items:stretch">
          <div class="card" style="flex:1;min-width:220px;max-width:320px">
            <div class="small muted">My Bookings</div>
            <div id="countBookings" style="font-weight:700;font-size:20px">0</div>
            <div style="margin-top:8px"><button class="btn btn-ghost" id="goToBookingsBtn">View Bookings</button></div>
          </div>

          <div class="card centered-notif" style="flex:1;min-width:220px;max-width:360px">
            <div class="small muted">Notifications</div>
            <div id="notifList" style="margin-top:8px;font-weight:600">No notifications</div>
            <small class="muted" style="margin-top:6px">Important messages shown here</small>
          </div>

          <div class="card centered-notif" style="flex:1;min-width:220px;max-width:320px">
            <div class="small muted">Pending Payments</div>
            <div id="pendingPayments" style="font-weight:700;font-size:20px">0</div>
            <small class="muted" style="margin-top:6px">Pending payments across system</small>
          </div>
        </div>

        <!-- Guest-only blue booking CTA -->
        <div id="guestCTA" style="margin-top:18px;display:none">
          <div class="blue-box">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <strong>Quick Book</strong>
                <div class="muted small">Reserve a room quickly — no payment required for demo.</div>
              </div>
              <div>
                <button class="btn btn-primary" id="quickBookBtn">Book Now</button>
              </div>
            </div>
          </div>
        </div>

      </section>

      <!-- Rooms -->
      <section id="rooms" class="section">
        <h3>Room Types</h3>
        <p class="small muted">Available room types and prices</p>
        <div class="grid-3" id="roomsGrid" style="margin-top:12px"></div>
      </section>

      <!-- Dining -->
      <section id="dining" class="section">
        <h3>Dining & Restaurant</h3>
        <p class="small">Reserve tables or check our menu.</p>
        <div style="margin-top:12px">
          <p class="muted">We offer all-day dining, room service, and weekend specials.</p>
          <button class="btn btn-ghost" id="openMenu">View Menu</button>
          <button class="btn btn-primary" id="reserveTable">Reserve a Table</button>
        </div>

        <div id="reserveForm" class="card" style="display:none;margin-top:12px">
          <h4>Reserve a Table</h4>
          <label>Date</label><input type="date" id="reservationDate" />
          <label>Time</label><input type="time" id="reservationTime" />
          <label>Guests</label><input type="number" id="reservationGuests" min="1" value="2" />
          <div style="display:flex;justify-content:flex-end;gap:8px">
            <button class="btn btn-primary" id="submitReservation">Submit</button>
            <button class="btn btn-ghost" id="cancelReserveBtn">Cancel</button>
          </div>
        </div>
      </section>

      <!-- Make Reservation -->
      <section id="makeReservation" class="section">
        <h3>Make a Reservation</h3>
        <div class="muted small">1) Select room → 2) Enter details → 3) Submit (goes to admin for approval)</div>

        <div style="margin-top:12px;max-width:680px">
          <div>
            <label>Room Type</label>
            <select id="selectRoomType"></select>
          </div>

          <div style="display:flex;gap:8px">
            <div style="flex:1">
              <label>Check-In</label>
              <input type="date" id="bookCheckIn">
            </div>
            <div style="flex:1">
              <label>Check-Out</label>
              <input type="date" id="bookCheckOut">
            </div>
          </div>

          <div style="display:flex;gap:8px">
            <div style="flex:1">
              <label>Guests</label>
              <input type="number" id="bookGuests" min="1" value="2">
            </div>
            <div style="flex:1">
              <label>Extras</label>
              <select id="bookExtras">
                <option value="none">None</option>
                <option value="breakfast">Breakfast included</option>
                <option value="spa">Spa voucher</option>
              </select>
            </div>
          </div>

          <div style="display:flex;gap:8px;margin-top:10px">
            <button class="btn btn-primary" id="checkAvailBtn">Check Availability</button>
            <button class="btn btn-ghost" id="resetMakeBtn">Reset</button>
          </div>

          <div id="availabilityResult" style="margin-top:12px"></div>

          <div id="bookingFormWrap" style="display:none;margin-top:12px" class="card">
            <h4>Booking Form</h4>
            <label>Full Name</label><input id="bfName" type="text">
            <label>Contact Number</label><input id="bfContact" type="text">
            <label>Email</label><input id="bfEmail" type="text">
            <div style="display:flex;justify-content:flex-end;gap:8px">
              <button class="btn btn-primary" id="proceedPaymentBtn">Submit Booking</button>
              <button class="btn btn-ghost" id="cancelBookingFormBtn">Cancel</button>
            </div>
          </div>
        </div>
      </section>

      <!-- My Bookings -->
      <section id="mybookings" class="section">
        <h3>My Bookings</h3>
        <p class="small muted">Upcoming / Past bookings</p>
        <div style="margin-top:12px" id="bookingsTable"></div>
      </section>

      <!-- Other -->
      <section id="other" class="section">
        <h3>Other Amenities</h3>
        <ul>
          <li>Airport Shuttle - Available 24/7</li>
          <li>Gym - Open 6 AM to 10 PM</li>
          <li>Kids Play Area - Free access</li>
        </ul>
      </section>

      <!-- Reports -->
      <section id="reports" class="section">
        <h3>Reports & Booking History</h3>
        <p class="small muted">Download booking history or invoices (demo)</p>
        <div id="reportsArea" style="margin-top:12px"></div>
      </section>

      <!-- Admin Panel -->
      <section id="adminPanel" class="section" style="display:none">
        <h3>Admin Panel</h3>
        <p class="small muted">Approve / Reject bookings, manage payments, users</p>
        <div style="margin-top:12px" id="adminArea"></div>
      </section>

    </main>
  </div>

  <footer>© <span id="year"></span> NORACAFRA HOTEL</footer>
</div>

<!-- modal for menu (simple) -->
<div id="menuModal" class="modal" aria-hidden>
  <div class="modal-card">
    <h3>Menu</h3>
    <ul>
      <li>Spaghetti Carbonara - ₱350</li>
      <li>Grilled Salmon - ₱500</li>
      <li>Vegetable Stir Fry - ₱250</li>
    </ul>
    <div style="display:flex;justify-content:flex-end;gap:8px">
      <button class="btn btn-ghost" id="closeMenu">Close</button>
    </div>
  </div>
</div>

<!-- register modal -->
<div id="registerModal" class="modal" aria-hidden>
  <div class="modal-card">
    <h3>Register (Guest)</h3>
    <label>Username</label><input id="rUser" placeholder="username">
    <label>Full name</label><input id="rName" placeholder="Full name">
    <label>Contact</label><input id="rContact" placeholder="Contact">
    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
      <button class="btn btn-ghost" id="registerCancelBtn">Cancel</button>
      <button class="btn btn-primary" id="registerUserBtn">Register</button>
    </div>
  </div>
</div>

<a id="downloadAnchor" style="display:none"></a>

<script>
/* ---------- Demo frontend-only reservation system ----------
   - role-based views (guest/admin)
   - bookings saved to localStorage
   - guest bookings create "pending" items visible to admin
   - admin can Accept / Reject and mark Paid
------------------------------------------------------------ */

/* --- demo data --- */
const rooms = [
  { id: 'r1', name: 'Standard Room', price: 2800, img: 'https://i.pinimg.com/1200x/ab/56/68/ab56689a873e0136ff76a84d69f27b08.jpg', qty: 5 },
  { id: 'r2', name: 'Deluxe Room', price: 4200, img: 'https://i.pinimg.com/736x/d3/59/f3/d359f321a1a7b4ae01b67286afc47c3a.jpg', qty: 3 },
  { id: 'r3', name: 'Suite', price: 7200, img: 'https://i.pinimg.com/1200x/06/d4/e3/06d4e3fb3727eb7a36b592c87a834973.jpg', qty: 2 }
];

let bookings = JSON.parse(localStorage.getItem('demo_bookings') || '[]');
let users = JSON.parse(localStorage.getItem('demo_users') || JSON.stringify([
  { username:'guest1', role:'guest', name:'Guest One' },
  { username:'staff1', role:'staff', name:'Staff One' },
  { username:'admin1', role:'admin', name:'Admin One' }
]));
let currentUser = null;
let provisional = null;

/* --- init --- */
document.getElementById('year').innerText = new Date().getFullYear();
renderRooms();
renderRoomsSelect();
updateCounts();
bindUI();

/* --- UI bind --- */
function bindUI(){
  document.getElementById('signInPrimary').addEventListener('click', frontPageSignIn);
  document.getElementById('openRegisterBtn').addEventListener('click', () => openModal('registerModal'));
  document.getElementById('registerUserBtn').addEventListener('click', registerUser);
  document.getElementById('registerCancelBtn').addEventListener('click', () => closeModal('registerModal'));
  document.getElementById('homeBtn').addEventListener('click', goHome);
  document.getElementById('signInBtn').addEventListener('click', () => { document.getElementById('frontPage').scrollIntoView(); });

  document.getElementById('openMenu').addEventListener('click', () => openModal('menuModal'));
  document.getElementById('closeMenu').addEventListener('click', () => closeModal('menuModal'));
  document.getElementById('reserveTable').addEventListener('click', () => { document.getElementById('reserveForm').style.display='block' });
  document.getElementById('cancelReserveBtn').addEventListener('click', () => { document.getElementById('reserveForm').style.display='none' });
  document.getElementById('submitReservation').addEventListener('click', () => alert('Table reserved (demo).'));

  document.getElementById('checkAvailBtn').addEventListener('click', checkAvailability);
  document.getElementById('resetMakeBtn').addEventListener('click', resetMake);
  document.getElementById('proceedPaymentBtn').addEventListener('click', submitBooking);
  document.getElementById('cancelBookingFormBtn').addEventListener('click', cancelBookingForm);

  document.getElementById('goToBookingsBtn').addEventListener('click', () => { showSection('mybookings'); renderBookings(); });

  document.getElementById('logoutBtn').addEventListener('click', logout);

  // menu click for navigation
  document.querySelectorAll('#menuList button[data-show]').forEach(b => b.addEventListener('click', e => showSection(e.currentTarget.dataset.show)));

  // quick book (guest CTA)
  document.getElementById('quickBookBtn').addEventListener('click', () => { showSection('makeReservation'); });

  // register modal shortcuts
  document.getElementById('registerUserBtn').addEventListener('click', () => closeModal('registerModal'));
}

/* --- modals --- */
function openModal(id){ const m=document.getElementById(id); if(m){ m.style.display='flex'; m.setAttribute('aria-hidden','false'); } }
function closeModal(id){ const m=document.getElementById(id); if(m){ m.style.display='none'; m.setAttribute('aria-hidden','true'); } }

/* --- auth --- */
function frontPageSignIn(){
  const role = document.getElementById('roleSelect').value;
  const username = (document.getElementById('username').value || (role+'1')).trim();
  attemptLogin({ username, role });
}

function attemptLogin({ username, role }){
  let user = users.find(u => u.username === username);
  if(!user){
    if(role === 'guest'){
      user = { username, role:'guest', name:username };
      users.push(user);
      persistUsers();
    } else {
      alert('User not found. For demo, use admin1 (admin) or staff1 (staff). Or register a guest.');
      return;
    }
  }
  currentUser = user;
  showAppForCurrentUser();
}

/* --- registration --- */
function registerUser(){
  const u = (document.getElementById('rUser').value || '').trim();
  const name = (document.getElementById('rName').value || u).trim();
  const contact = (document.getElementById('rContact').value || '').trim();
  if(!u){ alert('Enter username'); return; }
  if(users.find(x=>x.username===u)){ alert('Username exists'); return; }
  users.push({ username:u, role:'guest', name, contact });
  persistUsers();
  alert('Registered. You can now sign in as ' + u);
  closeModal('registerModal');
}

/* --- after login UI --- */
function showAppForCurrentUser(){
  document.getElementById('frontPage').style.display = 'none';
  document.getElementById('appContainer').style.display = 'block';
  document.getElementById('welcomeUser').innerText = 'Welcome, ' + (currentUser.name || currentUser.username);
  document.getElementById('userRole').innerText = 'Role: ' + (currentUser.role || 'guest');

  // show/hide admin menu
  document.getElementById('adminMenuItem').style.display = (currentUser.role === 'admin') ? '' : 'none';
  document.getElementById('adminPanel').style.display = (currentUser.role === 'admin') ? 'block' : 'none';
  document.getElementById('guestCTA').style.display = (currentUser.role === 'guest') ? '' : 'none';

  // update counts & content
  updateCounts();
  renderBookings();
  renderAdminArea();
  renderRooms();
  renderRoomsSelect();
  showSection('dashboard');
}

/* --- navigation --- */
function goHome(){ currentUser = null; document.getElementById('frontPage').style.display='block'; document.getElementById('appContainer').style.display='none'; }
function logout(){ if(confirm('Sign out?')) { location.reload(); } }
function showSection(id){
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  const s = document.getElementById(id);
  if(s) s.classList.add('active');

  document.querySelectorAll('#menuList button').forEach(b => b.classList.remove('active'));
  const btn = Array.from(document.querySelectorAll('#menuList button')).find(b => b.dataset.show === id);
  if(btn) btn.classList.add('active');
}

/* --- rooms --- */
function renderRooms(){
  const wrap = document.getElementById('roomsGrid');
  if(!wrap) return;
  wrap.innerHTML = '';
  rooms.forEach(r => {
    const el = document.createElement('div');
    el.className = 'room-card card';
    el.innerHTML = `<img src="${r.img}" alt="${r.name}">
      <div class="body">
        <strong>${r.name}</strong>
        <div class="small muted">₱${r.price} / night</div>
        <div style="margin-top:8px"><button class="btn btn-primary" data-reserve="${r.id}">Reserve</button></div>
      </div>`;
    wrap.appendChild(el);
  });
  wrap.querySelectorAll('[data-reserve]').forEach(b => b.addEventListener('click', e => startReserve(e.currentTarget.dataset.reserve)));
}

function renderRoomsSelect(){
  const sel = document.getElementById('selectRoomType');
  if(!sel) return;
  sel.innerHTML = '';
  rooms.forEach(r => sel.innerHTML += `<option value="${r.id}">${r.name} — ₱${r.price}</option>`);
}

function startReserve(roomId){
  showSection('makeReservation');
  document.getElementById('selectRoomType').value = roomId;
}

/* --- reservation flow --- */
function resetMake(){
  document.getElementById('bookCheckIn').value='';
  document.getElementById('bookCheckOut').value='';
  document.getElementById('bookGuests').value='2';
  document.getElementById('bookExtras').value='none';
  document.getElementById('availabilityResult').innerHTML='';
  document.getElementById('bookingFormWrap').style.display='none';
  provisional = null;
}

function checkAvailability(){
  const rid = document.getElementById('selectRoomType').value;
  const checkIn = document.getElementById('bookCheckIn').value;
  const checkOut = document.getElementById('bookCheckOut').value;
  if(!checkIn || !checkOut){ alert('Select dates'); return; }
  if(new Date(checkOut) <= new Date(checkIn)){ alert('Check-out must be after check-in'); return; }

  const r = rooms.find(x=>x.id===rid);
  if(!r){ alert('Room not found'); return; }

  // overlapping bookings for that room (status !== 'rejected')
  const overlapping = bookings.filter(b => b.roomId === rid && b.status !== 'rejected' &&
    !(new Date(b.checkOut) <= new Date(checkIn) || new Date(b.checkIn) >= new Date(checkOut))
  );
  const available = Math.max(0, r.qty - overlapping.length);
  document.getElementById('availabilityResult').innerHTML = `<div class="card small">Availability: <strong>${available}</strong> room(s) left for selected dates.</div>`;
  if(available > 0){
    document.getElementById('bookingFormWrap').style.display = 'block';
    if(currentUser){ document.getElementById('bfName').value = currentUser.name || currentUser.username; }
  } else {
    document.getElementById('bookingFormWrap').style.display = 'none';
  }
}

function cancelBookingForm(){ document.getElementById('bookingFormWrap').style.display='none'; provisional=null; }

function submitBooking(){
  const name = (document.getElementById('bfName').value || '').trim();
  const contact = (document.getElementById('bfContact').value || '').trim();
  const email = (document.getElementById('bfEmail').value || '').trim();
  if(!name || !contact){ alert('Please provide contact info'); return; }

  const p = {
    user: currentUser ? currentUser.username : 'guest',
    fullname: name, contact, email,
    roomId: document.getElementById('selectRoomType').value,
    roomName: rooms.find(r => r.id === document.getElementById('selectRoomType').value).name,
    checkIn: document.getElementById('bookCheckIn').value,
    checkOut: document.getElementById('bookCheckOut').value,
    guests: Number(document.getElementById('bookGuests').value),
    extras: document.getElementById('bookExtras').value,
    createdAt: new Date().toISOString(),
    status: 'pending' // guest submits -> pending for admin
  };

  // nights & total (for display later)
  const nights = Math.round((new Date(p.checkOut) - new Date(p.checkIn)) / (1000*60*60*24));
  p.nights = nights || 1;
  const room = rooms.find(r => r.id === p.roomId);
  p.pricePerNight = room.price;
  let extraCost = 0;
  if(p.extras === 'breakfast') extraCost = 200 * p.nights;
  if(p.extras === 'spa') extraCost = 1200;
  p.total = (room.price * p.nights) + extraCost;
  p.id = 'BK' + Math.floor(Math.random() * 900000 + 100000);

  bookings.push(p);
  persistBookings();
  updateCounts();
  renderBookings();
  renderAdminArea();
  alert('Booking sent. Status: PENDING (admin will review).');
  // redirect to bookings
  showSection('mybookings');
}

/* --- bookings rendering --- */
function renderBookings(){
  const user = currentUser ? currentUser.username : 'guest';
  const wrap = document.getElementById('bookingsTable');
  if(!wrap) return;
  const list = bookings.filter(b => b.user === user);
  if(list.length === 0){ wrap.innerHTML = '<div class="card small muted">No bookings found</div>'; return; }

  let html = `<table><thead><tr><th>ID</th><th>Room</th><th>Dates</th><th class="text-right">Total</th><th>Status</th><th></th></tr></thead><tbody>`;
  list.forEach(b => {
    html += `<tr>
      <td>${b.id}</td>
      <td>${b.roomName}</td>
      <td>${b.checkIn} → ${b.checkOut}</td>
      <td class="text-right">₱${b.total}</td>
      <td>${statusBadge(b.status)}</td>
      <td><button class="btn btn-ghost" data-invoice="${b.id}">Invoice</button></td>
    </tr>`;
  });
  html += '</tbody></table>';
  wrap.innerHTML = html;
  wrap.querySelectorAll('[data-invoice]').forEach(btn => btn.addEventListener('click', e => downloadInvoice(e.currentTarget.dataset.invoice)));
}

/* --- admin area --- */
function renderAdminArea(){
  const wrap = document.getElementById('adminArea');
  if(!wrap) return;
  if(currentUser && currentUser.role === 'admin'){
    // show pending bookings with actions
    const pending = bookings.filter(b => b.status === 'pending');
    let html = '<h4>Pending Reservations</h4>';
    if(pending.length === 0) html += '<div class="card small muted" style="padding:12px">No pending reservations</div>';
    else {
      html += '<table><thead><tr><th>ID</th><th>User</th><th>Room</th><th>Dates</th><th class="text-right">Total</th><th>Actions</th></tr></thead><tbody>';
      pending.forEach(b => {
        html += `<tr>
          <td>${b.id}</td>
          <td>${b.user}</td>
          <td>${b.roomName}</td>
          <td>${b.checkIn} → ${b.checkOut}</td>
          <td class="text-right">₱${b.total}</td>
          <td class="admin-controls">
            <button class="btn btn-primary" data-accept="${b.id}">Accept</button>
            <button class="btn btn-ghost" data-reject="${b.id}">Reject</button>
          </td>
        </tr>`;
      });
      html += '</tbody></table>';
    }

    // payments area
    const unpaid = bookings.filter(b => b.status === 'accepted' || b.status === 'confirmed').filter(x => x.status !== 'paid');
    html += '<h4 style="margin-top:12px">Payments</h4>';
    if(unpaid.length === 0) html += '<div class="card small muted" style="padding:12px">No pending payments</div>';
    else {
      html += '<table><thead><tr><th>ID</th><th>User</th><th>Total</th><th>Action</th></tr></thead><tbody>';
      unpaid.forEach(b => {
        html += `<tr><td>${b.id}</td><td>${b.user}</td><td class="text-right">₱${b.total}</td><td><button class="btn btn-primary" data-markpaid="${b.id}">Mark Paid</button></td></tr>`;
      });
      html += '</tbody></table>';
    }

    // users list
    html += '<h4 style="margin-top:12px">Users</h4>';
    html += '<table><thead><tr><th>Username</th><th>Role</th><th>Name</th></tr></thead><tbody>';
    users.forEach(u => html += `<tr><td>${u.username}</td><td>${u.role}</td><td>${u.name||''}</td></tr>`);
    html += '</tbody></table>';

    wrap.innerHTML = html;

    // bind accept/reject/pay buttons
    wrap.querySelectorAll('[data-accept]').forEach(b => b.addEventListener('click', e => adminAccept(e.currentTarget.dataset.accept)));
    wrap.querySelectorAll('[data-reject]').forEach(b => b.addEventListener('click', e => adminReject(e.currentTarget.dataset.reject)));
    wrap.querySelectorAll('[data-markpaid]').forEach(b => b.addEventListener('click', e => adminMarkPaid(e.currentTarget.dataset.markpaid)));
  } else {
    wrap.innerHTML = '<div class="card small muted">Admin only area</div>';
  }
}

function adminAccept(id){
  const b = bookings.find(x=>x.id===id);
  if(!b) return alert('Booking not found');
  b.status = 'accepted';
  persistBookings();
  updateCounts();
  renderAdminArea();
  renderBookings(); // update guest view if open
  alert('Booking accepted.');
}
function adminReject(id){
  if(!confirm('Reject this booking?')) return;
  const b = bookings.find(x=>x.id===id);
  if(!b) return alert('Booking not found');
  b.status = 'rejected';
  persistBookings();
  updateCounts();
  renderAdminArea();
  renderBookings();
  alert('Booking rejected.');
}
function adminMarkPaid(id){
  const b = bookings.find(x=>x.id===id);
  if(!b) return alert('Booking not found');
  b.status = 'paid';
  persistBookings();
  updateCounts();
  renderAdminArea();
  renderBookings();
  alert('Marked as paid.');
}

/* --- utilities --- */
function statusBadge(s){
  if(s === 'pending') return `<span class="badge badge-pending">PENDING</span>`;
  if(s === 'accepted' || s === 'confirmed') return `<span class="badge badge-paid">ACCEPTED</span>`;
  if(s === 'paid') return `<span class="badge badge-paid">PAID</span>`;
  if(s === 'rejected') return `<span class="muted">REJECTED</span>`;
  return s;
}

function updateCounts(){
  document.getElementById('countBookings').innerText = bookings.filter(b => b.user === (currentUser?currentUser.username:'guest')).length;
  const pending = bookings.filter(b => b.status === 'pending').length;
  document.getElementById('pendingPayments').innerText = bookings.filter(b => b.status !== 'paid' && b.status !== 'rejected').length;
  document.getElementById('notifList').innerText = (pending > 0) ? `You have ${pending} pending reservation(s)` : 'No notifications';
}

/* --- persistence --- */
function persistBookings(){ localStorage.setItem('demo_bookings', JSON.stringify(bookings)); }
function persistUsers(){ localStorage.setItem('demo_users', JSON.stringify(users)); }

/* --- invoice download (simple text) --- */
function downloadInvoice(id){
  const b = bookings.find(x=>x.id===id);
  if(!b){ alert('No booking'); return; }
  const content = `NORACAFRA HOTEL\nInvoice for Booking ${b.id}\n\nGuest: ${b.fullname}\nRoom: ${b.roomName}\nDates: ${b.checkIn} → ${b.checkOut}\nNights: ${b.nights}\nTotal: ₱${b.total}\n\nStatus: ${b.status}\n\nThank you for booking with NORACAFRA HOTEL.`;
  const blob = new Blob([content], {type: 'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.getElementById('downloadAnchor');
  a.href = url; a.download = `invoice_${b.id}.txt`; a.click(); URL.revokeObjectURL(url);
}

/* --- initial render of admin + bookings if someone already logged (rare) --- */
(function initIfNeeded(){
  // nothing to do initially
})();

</script>
</body>
</html>
